<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Family Chore Tracker</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useMemo } = React;

    // Firebase Configuration
    const firebaseConfig = {
      apiKey: "AIzaSyA0ChRwF_l8u-xregnGLoN3OAkGOiadJww",
      authDomain: "family-chores-92c31.firebaseapp.com",
      projectId: "family-chores-92c31",
      storageBucket: "family-chores-92c31.firebasestorage.app",
      messagingSenderId: "333651647825",
      appId: "1:333651647825:web:3db061aaec9883dbf24770"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const CheckCircle = ({ className, size = 24 }) => (
      <svg className={className} width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
        <polyline points="22 4 12 14.01 9 11.01"></polyline>
      </svg>
    );

    const Calendar = ({ className, size = 24 }) => (
      <svg className={className} width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
        <line x1="16" y1="2" x2="16" y2="6"></line>
        <line x1="8" y1="2" x2="8" y2="6"></line>
        <line x1="3" y1="10" x2="21" y2="10"></line>
      </svg>
    );

    const TrendingUp = ({ className, size = 24 }) => (
      <svg className={className} width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
        <polyline points="17 6 23 6 23 12"></polyline>
      </svg>
    );

    const Edit2 = ({ className, size = 24 }) => (
      <svg className={className} width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path>
      </svg>
    );

    const X = ({ className, size = 24 }) => (
      <svg className={className} width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    );

    const Settings = ({ className, size = 24 }) => (
      <svg className={className} width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <circle cx="12" cy="12" r="3"></circle>
        <path d="M12 1v6m0 6v6m6-12.001v-.001m-12 0v-.001m15.364 2.637l-.707.707m-12.02 0l-.707-.707m13.434 12.728l-.707-.707m-12.02 0l-.707.707M1 12h6m6 0h6"></path>
      </svg>
    );

    const ChoreTracker = () => {
      const [currentView, setCurrentView] = useState('upcoming');
      const [chores, setChores] = useState([]);
      const [completionHistory, setCompletionHistory] = useState([]);
      const [changeLog, setChangeLog] = useState([]);
      const [loading, setLoading] = useState(true);
      const [editingFrequency, setEditingFrequency] = useState(null);
      const [newFrequency, setNewFrequency] = useState('');
      const [showConfirmation, setShowConfirmation] = useState(false);
      const [confirmationData, setConfirmationData] = useState(null);
      const [lastCompletedChore, setLastCompletedChore] = useState(null);
      const [animatingChoreId, setAnimatingChoreId] = useState(null);
      const [expandedChoreId, setExpandedChoreId] = useState(null);
      const [editingConfirmationDate, setEditingConfirmationDate] = useState(false);
      const [confirmationEditDate, setConfirmationEditDate] = useState('');
      const [newChoreName, setNewChoreName] = useState('');
      const [newChoreFrequency, setNewChoreFrequency] = useState('7');
      const [newChoreAssignedTo, setNewChoreAssignedTo] = useState('Kawika');
      const [editingChoreName, setEditingChoreName] = useState(null);
      const [editedChoreName, setEditedChoreName] = useState('');
      const [showManageChores, setShowManageChores] = useState(false);
      const [showDeleteConfirm, setShowDeleteConfirm] = useState(false);
      const [choreToDelete, setChoreToDelete] = useState(null);
      const [currentMonth, setCurrentMonth] = useState(new Date());
      const [selectedDate, setSelectedDate] = useState(new Date());
      const [editingCompletedDate, setEditingCompletedDate] = useState('');
      const [editingCompletedBy, setEditingCompletedBy] = useState('');
      const [editingUpcomingDate, setEditingUpcomingDate] = useState('');
      const [expandedCalendarChoreId, setExpandedCalendarChoreId] = useState(null);

      // Load data from Firestore with real-time updates
      useEffect(() => {
        const unsubscribeChores = db.collection('chores').onSnapshot(snapshot => {
          const choreData = snapshot.docs.map(doc => ({
            id: doc.id,
            ...doc.data(),
            lastCompleted: doc.data().lastCompleted?.toDate() || new Date()
          }));
          setChores(choreData);
          setLoading(false);
        });

        const unsubscribeHistory = db.collection('completionHistory').orderBy('completedDate', 'desc').onSnapshot(snapshot => {
          const historyData = snapshot.docs.map(doc => ({
            id: doc.id,
            ...doc.data(),
            completedDate: doc.data().completedDate?.toDate() || new Date()
          }));
          setCompletionHistory(historyData);
        });

        const unsubscribeChangelog = db.collection('changeLog').orderBy('timestamp', 'desc').onSnapshot(snapshot => {
          const logData = snapshot.docs.map(doc => ({
            id: doc.id,
            ...doc.data(),
            timestamp: doc.data().timestamp?.toDate() || new Date()
          }));
          setChangeLog(logData);
        });

        return () => {
          unsubscribeChores();
          unsubscribeHistory();
          unsubscribeChangelog();
        };
      }, []);

      // Initialize default chores if database is empty
      useEffect(() => {
        if (!loading && chores.length === 0) {
          const defaultChores = [
            { name: 'Cleaning the toilets', frequency: 3, assignedTo: 'Kawika', lastCompleted: new Date('2025-09-28T22:00:00Z'), completedBy: 'Kawika' },
            { name: 'Cleaning the sinks', frequency: 3, assignedTo: 'Jordyn', lastCompleted: new Date('2025-09-27T22:00:00Z'), completedBy: 'Jordyn' },
            { name: 'Cleaning the dishwasher', frequency: 7, assignedTo: 'Kawika', lastCompleted: new Date('2025-09-25T22:00:00Z'), completedBy: 'Kawika' },
            { name: 'Vacuuming the hardwood floors', frequency: 7, assignedTo: 'Jordyn', lastCompleted: new Date('2025-09-24T22:00:00Z'), completedBy: 'Jordyn' },
            { name: 'Mopping the hardwood floors', frequency: 7, assignedTo: 'Kawika', lastCompleted: new Date('2025-09-24T22:00:00Z'), completedBy: 'Kawika' },
            { name: 'Scrubbing the bath tubs', frequency: 7, assignedTo: 'Jordyn', lastCompleted: new Date('2025-09-23T22:00:00Z'), completedBy: 'Jordyn' },
            { name: 'Washing the bed sheets', frequency: 14, assignedTo: 'Kawika', lastCompleted: new Date('2025-09-20T22:00:00Z'), completedBy: 'Kawika' },
            { name: 'Vacuuming the carpets', frequency: 7, assignedTo: 'Jordyn', lastCompleted: new Date('2025-09-26T22:00:00Z'), completedBy: 'Jordyn' },
            { name: 'Taking out the trash', frequency: 2, assignedTo: 'Kawika', lastCompleted: new Date('2025-09-29T22:00:00Z'), completedBy: 'Kawika' },
            { name: 'Emptying the cans', frequency: 7, assignedTo: 'Jordyn', lastCompleted: new Date('2025-09-25T22:00:00Z'), completedBy: 'Jordyn' }
          ];

          defaultChores.forEach(chore => {
            db.collection('chores').add({
              ...chore,
              lastCompleted: firebase.firestore.Timestamp.fromDate(chore.lastCompleted)
            });
          });
        }
      }, [loading, chores.length]);

      const getHawaiiDate = () => {
        const now = new Date();
        const hawaiiTime = new Date(now.toLocaleString('en-US', { timeZone: 'Pacific/Honolulu' }));
        return hawaiiTime;
      };

      const createHawaiiDate = (dateString) => {
        const [year, month, day] = dateString.split('-').map(Number);
        const date = new Date(Date.UTC(year, month - 1, day, 22, 0, 0));
        return date;
      };

      const formatDateToInput = (date) => {
        const hawaiiDateStr = date.toLocaleString('en-US', {
          timeZone: 'Pacific/Honolulu',
          year: 'numeric',
          month: '2-digit',
          day: '2-digit'
        });
        const [month, day, year] = hawaiiDateStr.split('/');
        return `${year}-${month.padStart(2, '0')}-${day.padStart(2, '0')}`;
      };

      const calculateNextDue = (lastCompleted, frequency) => {
        const next = new Date(lastCompleted);
        next.setDate(next.getDate() + frequency);
        return next;
      };

      const getDaysUntilDue = (nextDue) => {
        const today = getHawaiiDate();
        today.setHours(0, 0, 0, 0);
        const due = new Date(nextDue);
        due.setHours(0, 0, 0, 0);
        const diffTime = due - today;
        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        return diffDays;
      };

      const formatDate = (date) => {
        return new Date(date).toLocaleDateString('en-US', {
          month: 'short',
          day: 'numeric',
          year: 'numeric',
          timeZone: 'Pacific/Honolulu'
        });
      };

      const markAsComplete = async (choreId, completedBy) => {
        const today = getHawaiiDate();
        const completedChore = chores.find(c => c.id === choreId);
        const previousLastCompleted = completedChore.lastCompleted;
        const previousCompletedBy = completedChore.completedBy;
        const nextDue = calculateNextDue(today, completedChore.frequency);

        // Update chore
        await db.collection('chores').doc(choreId).update({
          lastCompleted: firebase.firestore.Timestamp.fromDate(today),
          completedBy: completedBy
        });

        // Add to completion history
        const historyRef = await db.collection('completionHistory').add({
          choreId: choreId,
          choreName: completedChore.name,
          completedDate: firebase.firestore.Timestamp.fromDate(today),
          completedBy: completedBy
        });

        // Add to change log
        const logRef = await db.collection('changeLog').add({
          action: 'completed',
          choreName: completedChore.name,
          person: completedBy,
          timestamp: firebase.firestore.Timestamp.fromDate(today),
          details: `Marked "${completedChore.name}" as completed`
        });

        setLastCompletedChore({
          choreId,
          previousLastCompleted,
          previousCompletedBy,
          historyEntryId: historyRef.id,
          logEntryId: logRef.id
        });

        setConfirmationData({
          choreName: completedChore.name,
          completedDate: today,
          completedBy: completedBy,
          nextDue: nextDue,
          choreId: choreId
        });
        setShowConfirmation(true);
      };

      const undoCompletion = async () => {
        if (lastCompletedChore) {
          // Revert chore
          await db.collection('chores').doc(lastCompletedChore.choreId).update({
            lastCompleted: firebase.firestore.Timestamp.fromDate(lastCompletedChore.previousLastCompleted),
            completedBy: lastCompletedChore.previousCompletedBy
          });

          // Remove history entry
          await db.collection('completionHistory').doc(lastCompletedChore.historyEntryId).delete();

          // Remove log entry
          await db.collection('changeLog').doc(lastCompletedChore.logEntryId).delete();

          // Add undo log entry
          const completedChore = chores.find(c => c.id === lastCompletedChore.choreId);
          await db.collection('changeLog').add({
            action: 'edited',
            choreName: completedChore.name,
            person: 'System',
            timestamp: firebase.firestore.Timestamp.fromDate(getHawaiiDate()),
            details: `Undid completion of "${completedChore.name}"`
          });

          setLastCompletedChore(null);
          setShowConfirmation(false);
        }
      };

      const addNewChore = async () => {
        if (newChoreName.trim()) {
          await db.collection('chores').add({
            name: newChoreName.trim(),
            frequency: parseInt(newChoreFrequency),
            assignedTo: newChoreAssignedTo,
            lastCompleted: firebase.firestore.Timestamp.fromDate(getHawaiiDate()),
            completedBy: newChoreAssignedTo
          });

          await db.collection('changeLog').add({
            action: 'edited',
            choreName: newChoreName.trim(),
            person: 'System',
            timestamp: firebase.firestore.Timestamp.fromDate(getHawaiiDate()),
            details: `Added new chore "${newChoreName.trim()}"`
          });

          setNewChoreName('');
          setNewChoreFrequency('7');
          setNewChoreAssignedTo('Kawika');
        }
      };

      const startEditChoreName = (chore) => {
        setEditingChoreName(chore.id);
        setEditedChoreName(chore.name);
      };

      const saveEditChoreName = async (choreId) => {
        if (editedChoreName.trim()) {
          const oldName = chores.find(c => c.id === choreId).name;

          await db.collection('chores').doc(choreId).update({
            name: editedChoreName.trim()
          });

          await db.collection('changeLog').add({
            action: 'edited',
            choreName: editedChoreName.trim(),
            person: 'System',
            timestamp: firebase.firestore.Timestamp.fromDate(getHawaiiDate()),
            details: `Renamed chore from "${oldName}" to "${editedChoreName.trim()}"`
          });

          setEditingChoreName(null);
          setEditedChoreName('');
        }
      };

      const cancelEditChoreName = () => {
        setEditingChoreName(null);
        setEditedChoreName('');
      };

      const startDeleteChore = (chore) => {
        setChoreToDelete(chore);
        setShowDeleteConfirm(true);
      };

      const confirmDeleteChore = async () => {
        if (choreToDelete) {
          await db.collection('chores').doc(choreToDelete.id).delete();

          // Delete related completion history
          const historySnapshot = await db.collection('completionHistory').where('choreId', '==', choreToDelete.id).get();
          historySnapshot.forEach(doc => doc.ref.delete());

          await db.collection('changeLog').add({
            action: 'edited',
            choreName: choreToDelete.name,
            person: 'System',
            timestamp: firebase.firestore.Timestamp.fromDate(getHawaiiDate()),
            details: `Deleted chore "${choreToDelete.name}"`
          });

          setShowDeleteConfirm(false);
          setChoreToDelete(null);
        }
      };

      const cancelDeleteChore = () => {
        setShowDeleteConfirm(false);
        setChoreToDelete(null);
      };

      const saveFrequency = async (choreId) => {
        const freq = parseInt(newFrequency);
        if (freq && freq > 0 && freq <= 365) {
          const chore = chores.find(c => c.id === choreId);
          const oldFreq = chore.frequency;

          setAnimatingChoreId(choreId);

          setTimeout(async () => {
            await db.collection('chores').doc(choreId).update({
              frequency: freq
            });

            await db.collection('changeLog').add({
              action: 'edited',
              choreName: chore.name,
              person: 'System',
              timestamp: firebase.firestore.Timestamp.fromDate(new Date()),
              details: `Updated frequency from every ${oldFreq} days to every ${freq} days`
            });

            cancelEditFrequency();

            setTimeout(() => {
              setAnimatingChoreId(null);
            }, 500);
          }, 100);
        }
      };

      const startEditFrequency = (chore) => {
        setEditingFrequency(chore.id);
        setNewFrequency(chore.frequency.toString());
      };

      const cancelEditFrequency = () => {
        setEditingFrequency(null);
        setNewFrequency('');
      };

      const toggleChoreExpand = (choreId) => {
        setExpandedChoreId(expandedChoreId === choreId ? null : choreId);
      };

      const upcomingChores = useMemo(() => {
        return chores
          .map(chore => ({
            ...chore,
            nextDue: calculateNextDue(chore.lastCompleted, chore.frequency),
            daysUntil: getDaysUntilDue(calculateNextDue(chore.lastCompleted, chore.frequency))
          }))
          .sort((a, b) => a.daysUntil - b.daysUntil);
      }, [chores]);

      const getStatusColor = (daysUntil) => {
        if (daysUntil < 0) return 'text-red-600';
        if (daysUntil === 0) return 'text-orange-600';
        if (daysUntil <= 2) return 'text-yellow-600';
        return 'text-teal-600';
      };

      const getStatusText = (daysUntil) => {
        if (daysUntil < 0) return `${Math.abs(daysUntil)} days overdue`;
        if (daysUntil === 0) return 'Due today';
        if (daysUntil === 1) return 'Due tomorrow';
        return `Due in ${daysUntil} days`;
      };

      const getWeeklyStats = () => {
        const weekAgo = new Date();
        weekAgo.setDate(weekAgo.getDate() - 7);

        const weeklyCompletions = completionHistory.filter(
          h => new Date(h.completedDate) >= weekAgo
        );

        const byPerson = weeklyCompletions.reduce((acc, curr) => {
          acc[curr.completedBy] = (acc[curr.completedBy] || 0) + 1;
          return acc;
        }, {});

        return { total: weeklyCompletions.length, byPerson, completions: weeklyCompletions };
      };

      const getMonthlyStats = () => {
        const monthAgo = new Date();
        monthAgo.setDate(monthAgo.getDate() - 30);

        const monthlyCompletions = completionHistory.filter(
          h => new Date(h.completedDate) >= monthAgo
        );

        const byPerson = monthlyCompletions.reduce((acc, curr) => {
          acc[curr.completedBy] = (acc[curr.completedBy] || 0) + 1;
          return acc;
        }, {});

        return { total: monthlyCompletions.length, byPerson, completions: monthlyCompletions };
      };

      const weeklyStats = getWeeklyStats();
      const monthlyStats = getMonthlyStats();

      const getDaysInMonth = (date) => {
        const year = date.getFullYear();
        const month = date.getMonth();
        const firstDay = new Date(year, month, 1);
        const lastDay = new Date(year, month + 1, 0);
        const daysInMonth = lastDay.getDate();
        const startingDayOfWeek = firstDay.getDay();
        return { daysInMonth, startingDayOfWeek, year, month };
      };

      const getChoresForDate = (date) => {
        const dateStr = date.toDateString();
        const completed = completionHistory.filter(completion => {
          return new Date(completion.completedDate).toDateString() === dateStr;
        }).map(completion => ({
          ...chores.find(c => c.id === completion.choreId),
          type: 'completed',
          completedBy: completion.completedBy,
          completedDate: completion.completedDate,
          completionId: completion.id
        }));

        const upcoming = upcomingChores.filter(chore => {
          return new Date(chore.nextDue).toDateString() === dateStr;
        }).map(chore => ({
          ...chore,
          type: 'upcoming'
        }));

        return { completed, upcoming };
      };

      const isToday = (date) => {
        const today = getHawaiiDate();
        return date.toDateString() === today.toDateString();
      };

      const isSameDay = (date1, date2) => {
        return date1.toDateString() === date2.toDateString();
      };

      const changeMonth = (direction) => {
        setCurrentMonth(prev => {
          const newDate = new Date(prev);
          newDate.setMonth(prev.getMonth() + direction);
          return newDate;
        });
      };

      if (loading) {
        return (
          <div className="min-h-screen bg-gray-50 flex items-center justify-center">
            <div className="text-center">
              <div className="w-16 h-16 border-4 border-teal-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
              <p className="text-gray-600">Loading chores...</p>
            </div>
          </div>
        );
      }

      return (
        <div className="min-h-screen bg-gray-50 p-4">
          {showDeleteConfirm && choreToDelete && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4" style={{ zIndex: 9999 }}>
              <div className="bg-white rounded-3xl shadow-2xl max-w-md w-full p-8 relative">
                <div className="text-center mb-6">
                  <div className="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <X className="w-8 h-8 text-red-600" />
                  </div>

                <div className="bg-white rounded-2xl shadow-sm p-6">
                  <div className="flex items-center justify-between mb-6">
                    <h2 className="text-2xl font-bold text-gray-800">
                      {isToday(selectedDate) ? 'Today' : selectedDate.toLocaleDateString('en-US', { 
                        weekday: 'long', 
                        month: 'long', 
                        day: 'numeric',
                        year: 'numeric'
                      })}
                    </h2>
                    {!isToday(selectedDate) && (
                      <button
                        onClick={() => setSelectedDate(getHawaiiDate())}
                        className="px-4 py-2 bg-teal-100 text-teal-700 rounded-xl text-sm font-medium hover:bg-teal-200 transition"
                      >
                        Go to Today
                      </button>
                    )}
                  </div>

                  {(() => {
                    const { completed, upcoming } = getChoresForDate(selectedDate);
                    if (completed.length === 0 && upcoming.length === 0) {
                      return (
                        <div className="text-center py-12">
                          <Calendar className="w-16 h-16 text-gray-300 mx-auto mb-4" />
                          <p className="text-gray-400 text-lg">No chores for this day</p>
                        </div>
                      );
                    }

                    return (
                      <div className="space-y-6">
                        {completed.length > 0 && (
                          <div>
                            <h3 className="text-lg font-semibold text-gray-800 mb-3 flex items-center gap-2">
                              <CheckCircle className="w-5 h-5 text-green-600" />
                              Completed ({completed.length})
                            </h3>
                            <div className="space-y-2">
                              {completed.map((chore) => {
                                const choreKey = `completed-${chore.completionId}`;
                                const isExpanded = expandedCalendarChoreId === choreKey;
                                return (
                                  <div
                                    key={choreKey}
                                    className="bg-green-50 border-2 border-green-200 rounded-xl overflow-hidden"
                                  >
                                    <div
                                      onClick={() => setExpandedCalendarChoreId(isExpanded ? null : choreKey)}
                                      className="p-4 cursor-pointer hover:bg-green-100 transition"
                                    >
                                      <div className="flex justify-between items-start">
                                        <div className="flex-1">
                                          <h4 className="font-semibold text-gray-800">{chore.name}</h4>
                                          <p className="text-sm text-gray-600 mt-1">
                                            Completed by {chore.completedBy}
                                          </p>
                                        </div>
                                        <div className="text-xs text-green-700 bg-green-100 px-2 py-1 rounded-full">
                                          ✓ Done
                                        </div>
                                      </div>
                                    </div>

                                    {isExpanded && (
                                      <div className="px-4 pb-4 pt-2 border-t border-green-200 space-y-3">
                                        <div>
                                          <label className="text-xs text-gray-600 block mb-1">Completed on</label>
                                          <input
                                            type="date"
                                            value={editingCompletedDate || formatDateToInput(new Date(chore.completedDate))}
                                            onChange={(e) => setEditingCompletedDate(e.target.value)}
                                            className="w-full px-3 py-2 text-sm border-2 border-gray-200 rounded-lg focus:outline-none focus:border-teal-400"
                                          />
                                        </div>
                                        <div>
                                          <label className="text-xs text-gray-600 block mb-1">Completed by</label>
                                          <select
                                            value={editingCompletedBy || chore.completedBy}
                                            onChange={(e) => setEditingCompletedBy(e.target.value)}
                                            className="w-full px-3 py-2 text-sm border-2 border-gray-200 rounded-lg focus:outline-none focus:border-teal-400"
                                          >
                                            <option value="Kawika">Kawika</option>
                                            <option value="Jordyn">Jordyn</option>
                                          </select>
                                        </div>
                                        <button
                                          onClick={async () => {
                                            const newDate = createHawaiiDate(editingCompletedDate || formatDateToInput(new Date(chore.completedDate)));
                                            const newPerson = editingCompletedBy || chore.completedBy;
                                            await db.collection('completionHistory').doc(chore.completionId).update({
                                              completedDate: firebase.firestore.Timestamp.fromDate(newDate),
                                              completedBy: newPerson
                                            });

                                            await db.collection('changeLog').add({
                                              action: 'edited',
                                              choreName: chore.name,
                                              person: 'System',
                                              timestamp: firebase.firestore.Timestamp.fromDate(getHawaiiDate()),
                                              details: `Updated completion record for "${chore.name}"`
                                            });

                                            setEditingCompletedDate('');
                                            setEditingCompletedBy('');
                                            setExpandedCalendarChoreId(null);
                                          }}
                                          className="w-full bg-teal-500 text-white py-2 rounded-xl font-medium hover:bg-teal-600 transition text-sm"
                                        >
                                          Update Completion
                                        </button>
                                      </div>
                                    )}
                                  </div>
                                );
                              })}
                            </div>
                          </div>
                        )}

                        {upcoming.length > 0 && (
                          <div>
                            <h3 className="text-lg font-semibold text-gray-800 mb-3 flex items-center gap-2">
                              <Calendar className="w-5 h-5 text-orange-600" />
                              Due Today ({upcoming.length})
                            </h3>
                            <div className="space-y-2">
                              {upcoming.map((chore) => {
                                const choreKey = `upcoming-${chore.id}`;
                                const isExpanded = expandedCalendarChoreId === choreKey;
                                return (
                                  <div
                                    key={choreKey}
                                    className="bg-orange-50 border-2 border-orange-200 rounded-xl overflow-hidden"
                                  >
                                    <div
                                      onClick={() => setExpandedCalendarChoreId(isExpanded ? null : choreKey)}
                                      className="p-4 cursor-pointer hover:bg-orange-100 transition"
                                    >
                                      <div className="flex justify-between items-start">
                                        <div className="flex-1">
                                          <h4 className="font-semibold text-gray-800">{chore.name}</h4>
                                          <p className="text-sm text-gray-600 mt-1">
                                            Assigned to {chore.assignedTo} • Every {chore.frequency} days
                                          </p>
                                          <p className={`text-sm font-medium mt-1 ${getStatusColor(chore.daysUntil)}`}>
                                            {getStatusText(chore.daysUntil)}
                                          </p>
                                        </div>
                                      </div>
                                    </div>

                                    {isExpanded && (
                                      <div className="px-4 pb-4 pt-2 border-t border-orange-200 space-y-3">
                                        <div>
                                          <label className="text-xs text-gray-600 block mb-1">Reschedule due date</label>
                                          <input
                                            type="date"
                                            value={editingUpcomingDate || formatDateToInput(chore.nextDue)}
                                            onChange={(e) => setEditingUpcomingDate(e.target.value)}
                                            className="w-full px-3 py-2 text-sm border-2 border-gray-200 rounded-lg focus:outline-none focus:border-orange-400"
                                          />
                                        </div>
                                        <button
                                          onClick={async () => {
                                            const newDueDate = createHawaiiDate(editingUpcomingDate || formatDateToInput(chore.nextDue));
                                            const newLastCompleted = new Date(newDueDate);
                                            newLastCompleted.setDate(newDueDate.getDate() - chore.frequency);
                                            await db.collection('chores').doc(chore.id).update({
                                              lastCompleted: firebase.firestore.Timestamp.fromDate(newLastCompleted)
                                            });

                                            await db.collection('changeLog').add({
                                              action: 'edited',
                                              choreName: chore.name,
                                              person: 'System',
                                              timestamp: firebase.firestore.Timestamp.fromDate(getHawaiiDate()),
                                              details: `Rescheduled "${chore.name}" to be due on ${formatDate(newDueDate)}`
                                            });

                                            setEditingUpcomingDate('');
                                            setExpandedCalendarChoreId(null);
                                          }}
                                          className="w-full bg-orange-500 text-white py-2 rounded-xl font-medium hover:bg-orange-600 transition text-sm"
                                        >
                                          Update Due Date
                                        </button>

                                        {isToday(selectedDate) && (
                                          <>
                                            <div className="text-xs text-gray-500 text-center">or mark as complete</div>
                                            <div className="grid grid-cols-2 gap-2">
                                              <button
                                                onClick={() => markAsComplete(chore.id, 'Kawika')}
                                                className="bg-teal-500 text-white py-2 px-4 rounded-xl font-medium hover:bg-teal-600 transition text-sm"
                                              >
                                                Kawika completed
                                              </button>
                                              <button
                                                onClick={() => markAsComplete(chore.id, 'Jordyn')}
                                                className="bg-white border-2 border-teal-500 text-teal-600 py-2 px-4 rounded-xl font-medium hover:bg-teal-50 transition text-sm"
                                              >
                                                Jordyn completed
                                              </button>
                                            </div>
                                          </>
                                        )}
                                      </div>
                                    )}
                                  </div>
                                );
                              })}
                            </div>
                          </div>
                        )}
                      </div>
                    );
                  })()}
                </div>
              </div>
            )}
          </div>
        </div>
      );
    };

    ReactDOM.render(<ChoreTracker />, document.getElementById('root'));
  </script>
</body>
</html>  <h2 className="text-2xl font-bold text-gray-800 mb-2">Are you sure?</h2>
                  <p className="text-gray-600">Do you want to delete this chore?</p>
                </div>

                <div className="bg-gray-50 rounded-2xl p-6 mb-6">
                  <div className="text-sm text-gray-500 mb-1">Chore</div>
                  <div className="text-lg font-semibold text-gray-800 mb-2">{choreToDelete.name}</div>
                  <div className="text-sm text-gray-600">Every {choreToDelete.frequency} days • {choreToDelete.assignedTo}</div>
                </div>

                <p className="text-sm text-red-600 font-medium mb-6 text-center bg-red-50 p-3 rounded-lg">
                  ⚠️ This action cannot be undone
                </p>

                <div className="flex gap-3">
                  <button
                    onClick={cancelDeleteChore}
                    className="flex-1 bg-gray-200 text-gray-700 py-3 rounded-xl font-medium hover:bg-gray-300 transition"
                  >
                    Go Back
                  </button>
                  <button
                    onClick={confirmDeleteChore}
                    className="flex-1 bg-red-500 text-white py-3 rounded-xl font-medium hover:bg-red-600 transition"
                  >
                    Delete
                  </button>
                </div>
              </div>
            </div>
          )}

          {showConfirmation && confirmationData && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
              <div className="bg-white rounded-3xl shadow-2xl max-w-md w-full p-8 relative">
                <button
                  onClick={() => setShowConfirmation(false)}
                  className="absolute top-4 right-4 text-gray-400 hover:text-gray-600 transition"
                >
                  <X size={24} />
                </button>

                <div className="text-center mb-6">
                  <div className="w-16 h-16 bg-teal-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <CheckCircle className="w-8 h-8 text-teal-600" />
                  </div>
                  <h2 className="text-2xl font-bold text-gray-800 mb-2">Confirm Completed</h2>
                </div>

                <div className="space-y-4 bg-gray-50 rounded-2xl p-6">
                  <div>
                    <div className="text-sm text-gray-500 mb-1">Chore</div>
                    <div className="text-lg font-semibold text-gray-800">{confirmationData.choreName}</div>
                  </div>

                  <div className="grid grid-cols-2 gap-4">
                    <div>
                      <div className="text-sm text-gray-500 mb-1">Completed by</div>
                      <div className="font-medium text-gray-800">{confirmationData.completedBy}</div>
                    </div>
                    <div>
                      <div className="text-sm text-gray-500 mb-1">Completed on</div>
                      {editingConfirmationDate ? (
                        <div className="space-y-2">
                          <input
                            type="date"
                            value={confirmationEditDate}
                            onChange={(e) => setConfirmationEditDate(e.target.value)}
                            className="w-full px-2 py-1 text-sm border-2 border-teal-400 rounded-lg focus:outline-none focus:border-teal-500"
                            autoFocus
                          />
                          <div className="flex gap-2">
                            <button
                              onClick={async () => {
                                const newDate = createHawaiiDate(confirmationEditDate);
                                await db.collection('chores').doc(confirmationData.choreId).update({
                                  lastCompleted: firebase.firestore.Timestamp.fromDate(newDate)
                                });
                                if (lastCompletedChore?.historyEntryId) {
                                  await db.collection('completionHistory').doc(lastCompletedChore.historyEntryId).update({
                                    completedDate: firebase.firestore.Timestamp.fromDate(newDate)
                                  });
                                }

                                setConfirmationData(prev => ({
                                  ...prev,
                                  completedDate: newDate,
                                  nextDue: calculateNextDue(newDate, chores.find(c => c.id === prev.choreId).frequency)
                                }));
                                setEditingConfirmationDate(false);
                              }}
                              className="flex-1 bg-teal-500 text-white py-1 rounded-lg text-xs font-medium hover:bg-teal-600 transition"
                            >
                              Save
                            </button>
                            <button
                              onClick={() => {
                                setEditingConfirmationDate(false);
                                setConfirmationEditDate('');
                              }}
                              className="flex-1 bg-gray-300 text-gray-700 py-1 rounded-lg text-xs font-medium hover:bg-gray-400 transition"
                            >
                              Cancel
                            </button>
                          </div>
                        </div>
                      ) : (
                        <div
                          onClick={() => {
                            setEditingConfirmationDate(true);
                            setConfirmationEditDate(formatDateToInput(confirmationData.completedDate));
                          }}
                          className="font-medium text-gray-800 cursor-pointer hover:text-teal-600 transition flex items-center gap-2"
                        >
                          {formatDate(confirmationData.completedDate)}
                          <Edit2 className="w-4 h-4 text-gray-400" />
                        </div>
                      )}
                    </div>
                  </div>

                  <div className="pt-4 border-t border-gray-200">
                    <div className="text-sm text-gray-500 mb-1">Next due date</div>
                    <div className="text-lg font-semibold text-teal-600">{formatDate(confirmationData.nextDue)}</div>
                  </div>
                </div>

                <button
                  onClick={() => {
                    setShowConfirmation(false);
                    setEditingConfirmationDate(false);
                    setConfirmationEditDate('');
                  }}
                  className="w-full mt-6 bg-teal-500 text-white py-3 rounded-xl font-medium hover:bg-teal-600 transition"
                >
                  Confirm
                </button>

                <button
                  onClick={undoCompletion}
                  className="w-full mt-3 bg-white border-2 border-gray-300 text-gray-700 py-3 rounded-xl font-medium hover:bg-gray-50 transition"
                >
                  Go Back
                </button>
              </div>
            </div>
          )}

          <div className="max-w-6xl mx-auto">
            <div className="flex justify-between items-center mb-6">
              <div className="text-2xl font-bold text-gray-800">Family Chore Tracker</div>
              <button
                onClick={() => setShowManageChores(true)}
                className="flex items-center gap-2 px-4 py-2 bg-white border-2 border-gray-200 rounded-xl text-gray-700 font-medium hover:border-teal-400 hover:text-teal-600 transition"
              >
                <Settings size={18} />
                Manage Chores
              </button>
            </div>

            {showManageChores && (
              <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 overflow-y-auto">
                <div className="bg-white rounded-3xl shadow-2xl max-w-2xl w-full my-auto max-h-[90vh] flex flex-col relative">
                  <button
                    onClick={() => setShowManageChores(false)}
                    className="absolute top-4 right-4 text-gray-400 hover:text-gray-600 transition z-10"
                  >
                    <X size={24} />
                  </button>

                  <div className="p-6 pb-3 flex-shrink-0">
                    <h2 className="text-xl font-bold text-gray-800 mb-1">Manage Chores</h2>
                    <p className="text-sm text-gray-600">Add new chores, edit names, and adjust frequencies</p>
                  </div>

                  <div className="flex-1 overflow-y-auto px-6 min-h-0">
                    <div className="mb-4 p-3 bg-teal-50 rounded-2xl border-2 border-teal-200">
                      <h3 className="font-semibold text-gray-800 mb-2 text-sm">Add New Chore</h3>
                      <div className="space-y-2">
                        <input
                          type="text"
                          value={newChoreName}
                          onChange={(e) => setNewChoreName(e.target.value)}
                          onKeyDown={(e) => e.key === 'Enter' && addNewChore()}
                          className="w-full px-3 py-2 text-sm border-2 border-gray-200 rounded-xl focus:outline-none focus:border-teal-400"
                          placeholder="Chore name"
                        />
                        <div className="grid grid-cols-2 gap-2">
                          <input
                            type="number"
                            value={newChoreFrequency}
                            onChange={(e) => setNewChoreFrequency(e.target.value)}
                            className="w-full px-3 py-2 text-sm border-2 border-gray-200 rounded-xl focus:outline-none focus:border-teal-400"
                            placeholder="Days"
                            min="1"
                            max="365"
                          />
                          <select
                            value={newChoreAssignedTo}
                            onChange={(e) => setNewChoreAssignedTo(e.target.value)}
                            className="w-full px-3 py-2 text-sm border-2 border-gray-200 rounded-xl focus:outline-none focus:border-teal-400"
                          >
                            <option value="Kawika">Kawika</option>
                            <option value="Jordyn">Jordyn</option>
                          </select>
                        </div>
                        <button
                          onClick={addNewChore}
                          className="w-full bg-teal-500 text-white py-2 rounded-xl text-sm font-medium hover:bg-teal-600 transition"
                        >
                          Add Chore
                        </button>
                      </div>
                    </div>

                    <div className="mb-4">
                      <h3 className="font-semibold text-gray-800 mb-2 text-sm">Existing Chores</h3>
                      <div className="space-y-2">
                        {chores.map((chore) => (
                          <div key={chore.id} className="p-3 bg-gray-50 rounded-xl border-2 border-gray-200">
                            {editingChoreName === chore.id ? (
                              <div className="space-y-2">
                                <input
                                  type="text"
                                  value={editedChoreName}
                                  onChange={(e) => setEditedChoreName(e.target.value)}
                                  onKeyDown={(e) => {
                                    if (e.key === 'Enter') {
                                      saveEditChoreName(chore.id);
                                    } else if (e.key === 'Escape') {
                                      cancelEditChoreName();
                                    }
                                  }}
                                  className="w-full px-3 py-2 text-sm border-2 border-teal-400 rounded-lg focus:outline-none focus:border-teal-500"
                                  autoFocus
                                />
                                <div className="flex gap-2">
                                  <button
                                    onClick={() => saveEditChoreName(chore.id)}
                                    className="flex-1 bg-teal-500 text-white py-1.5 rounded-lg font-medium hover:bg-teal-600 transition text-sm"
                                  >
                                    Save
                                  </button>
                                  <button
                                    onClick={cancelEditChoreName}
                                    className="flex-1 bg-gray-300 text-gray-700 py-1.5 rounded-lg font-medium hover:bg-gray-400 transition text-sm"
                                  >
                                    Cancel
                                  </button>
                                </div>
                              </div>
                            ) : editingFrequency === chore.id ? (
                              <div className="space-y-2">
                                <div className="flex items-center gap-2 text-sm">
                                  <span className="text-gray-700">{chore.name} - Every</span>
                                  <input
                                    type="number"
                                    value={newFrequency}
                                    onChange={(e) => setNewFrequency(e.target.value)}
                                    onKeyDown={(e) => {
                                      if (e.key === 'Enter') {
                                        saveFrequency(chore.id);
                                      } else if (e.key === 'Escape') {
                                        cancelEditFrequency();
                                      }
                                    }}
                                    className="w-16 px-2 py-1 text-sm border-2 border-teal-400 rounded-lg text-center focus:outline-none focus:border-teal-500"
                                    min="1"
                                    max="365"
                                    autoFocus
                                  />
                                  <span className="text-gray-700">days</span>
                                </div>
                                <div className="flex gap-2">
                                  <button
                                    onClick={() => saveFrequency(chore.id)}
                                    className="flex-1 bg-teal-500 text-white py-1.5 rounded-lg font-medium hover:bg-teal-600 transition text-sm"
                                  >
                                    Save
                                  </button>
                                  <button
                                    onClick={cancelEditFrequency}
                                    className="flex-1 bg-gray-300 text-gray-700 py-1.5 rounded-lg font-medium hover:bg-gray-400 transition text-sm"
                                  >
                                    Cancel
                                  </button>
                                </div>
                              </div>
                            ) : (
                              <div className="space-y-2">
                                <div className="flex justify-between items-center gap-2">
                                  <div className="flex-1 min-w-0">
                                    <div className="font-medium text-gray-800 text-sm truncate">{chore.name}</div>
                                    <div className="text-xs text-gray-500">Every {chore.frequency} days • {chore.assignedTo}</div>
                                  </div>
                                  <button
                                    onClick={() => startDeleteChore(chore)}
                                    className="px-2 py-1 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition text-xs font-medium flex-shrink-0"
                                  >
                                    Delete
                                  </button>
                                </div>
                                <div className="grid grid-cols-2 gap-2 pt-2 border-t border-gray-200">
                                  <button
                                    onClick={() => startEditChoreName(chore)}
                                    className="px-3 py-2 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition text-xs font-medium"
                                  >
                                    Edit Name
                                  </button>
                                  <button
                                    onClick={() => startEditFrequency(chore)}
                                    className="px-3 py-2 bg-purple-100 text-purple-700 rounded-lg hover:bg-purple-200 transition text-xs font-medium"
                                  >
                                    Edit Frequency
                                  </button>
                                </div>
                              </div>
                            )}
                          </div>
                        ))}
                      </div>
                    </div>
                  </div>

                  <div className="p-6 pt-3 border-t border-gray-200 flex-shrink-0">
                    <button
                      onClick={() => setShowManageChores(false)}
                      className="w-full bg-gray-200 text-gray-700 py-2.5 rounded-xl font-medium hover:bg-gray-300 transition"
                    >
                      Done
                    </button>
                  </div>
                </div>
              </div>
            )}

            <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
              <button
                onClick={() => setCurrentView('upcoming')}
                className={`rounded-2xl p-6 text-left transition-all ${
                  currentView === 'upcoming'
                    ? 'bg-teal-500 text-white shadow-lg'
                    : 'bg-white text-gray-600 hover:shadow-md'
                }`}
              >
                <CheckCircle className="w-8 h-8 mb-2" />
                <div className="font-medium text-lg">Chores</div>
              </button>
              <button
                onClick={() => setCurrentView('dashboard')}
                className={`rounded-2xl p-6 text-left transition-all ${
                  currentView === 'dashboard'
                    ? 'bg-teal-500 text-white shadow-lg'
                    : 'bg-white text-gray-600 hover:shadow-md'
                }`}
              >
                <TrendingUp className="w-8 h-8 mb-2" />
                <div className="font-medium text-lg">Dashboard</div>
              </button>
              <button
                onClick={() => setCurrentView('calendar')}
                className={`rounded-2xl p-6 text-left transition-all ${
                  currentView === 'calendar'
                    ? 'bg-teal-500 text-white shadow-lg'
                    : 'bg-white text-gray-600 hover:shadow-md'
                }`}
              >
                <Calendar className="w-8 h-8 mb-2" />
                <div className="font-medium text-lg">Calendar</div>
              </button>
              <button
                onClick={() => setCurrentView('changelog')}
                className={`rounded-2xl p-6 text-left transition-all ${
                  currentView === 'changelog'
                    ? 'bg-teal-500 text-white shadow-lg'
                    : 'bg-white text-gray-600 hover:shadow-md'
                }`}
              >
                <Edit2 className="w-8 h-8 mb-2" />
                <div className="font-medium text-lg">Change Log</div>
              </button>
            </div>

            {currentView === 'changelog' && (
              <div className="bg-white rounded-2xl shadow-sm p-6">
                <div className="text-2xl font-medium text-gray-800 mb-6">Change Log</div>
                {changeLog.length === 0 ? (
                  <div className="text-center py-12">
                    <Calendar className="w-16 h-16 text-gray-300 mx-auto mb-4" />
                    <p className="text-gray-400 text-lg">No activity yet</p>
                    <p className="text-gray-400 text-sm mt-2">Actions will appear here as you use the app</p>
                  </div>
                ) : (
                  <div className="space-y-3">
                    {changeLog.map((log) => (
                      <div
                        key={log.id}
                        className="p-4 bg-gray-50 rounded-xl border-2 border-transparent hover:border-teal-200 transition-all"
                      >
                        <div className="flex items-start justify-between mb-2">
                          <div className="flex items-center gap-3">
                            <div className={`w-10 h-10 rounded-full flex items-center justify-center ${
                              log.action === 'completed' ? 'bg-teal-100' : 'bg-blue-100'
                            }`}>
                              {log.action === 'completed' ? (
                                <CheckCircle className="w-5 h-5 text-teal-600" />
                              ) : (
                                <Edit2 className="w-5 h-5 text-blue-600" />
                              )}
                            </div>
                            <div>
                              <div className="font-medium text-gray-800">{log.details}</div>
                              <div className="text-sm text-gray-500 mt-1">By {log.person}</div>
                            </div>
                          </div>
                          <div className="text-xs text-gray-400">
                            {new Date(log.timestamp).toLocaleString('en-US', {
                              month: 'short',
                              day: 'numeric',
                              hour: 'numeric',
                              minute: '2-digit',
                              hour12: true
                            })}
                          </div>
                        </div>
                      </div>
                    ))}
                  </div>
                )}
              </div>
            )}

            {currentView === 'dashboard' && (
              <div className="space-y-4">
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div className="bg-white rounded-2xl shadow-sm p-6 border-2 border-transparent hover:border-teal-400 transition-all">
                    <div className="text-sm text-gray-500 mb-2">This Week</div>
                    <div className="text-4xl font-bold text-teal-600 mb-4">{weeklyStats.total}</div>
                    <div className="text-gray-600 mb-4">Chores completed</div>
                    <div className="space-y-2 mb-4">
                      {Object.entries(weeklyStats.byPerson).map(([person, count]) => (
                        <div key={person} className="flex justify-between items-center">
                          <span className="text-gray-700">{person}</span>
                          <div className="w-16 h-2 bg-gray-200 rounded-full overflow-hidden">
                            <div
                              className="h-full bg-teal-500 rounded-full"
                              style={{ width: `${(count / weeklyStats.total) * 100}%` }}
                            />
                          </div>
                          <span className="text-teal-600 font-medium text-sm">{count}</span>
                        </div>
                      ))}
                      {Object.keys(weeklyStats.byPerson).length === 0 && (
                        <p className="text-gray-400 text-sm">No chores completed this week yet</p>
                      )}
                    </div>
                  </div>

                  <div className="bg-white rounded-2xl shadow-sm p-6 border-2 border-transparent hover:border-teal-400 transition-all">
                    <div className="text-sm text-gray-500 mb-2">This Month</div>
                    <div className="text-4xl font-bold text-teal-600 mb-4">{monthlyStats.total}</div>
                    <div className="text-gray-600 mb-4">Chores completed</div>
                    <div className="space-y-2 mb-4">
                      {Object.entries(monthlyStats.byPerson).map(([person, count]) => (
                        <div key={person} className="flex justify-between items-center">
                          <span className="text-gray-700">{person}</span>
                          <div className="w-16 h-2 bg-gray-200 rounded-full overflow-hidden">
                            <div
                              className="h-full bg-teal-500 rounded-full"
                              style={{ width: `${(count / monthlyStats.total) * 100}%` }}
                            />
                          </div>
                          <span className="text-teal-600 font-medium text-sm">{count}</span>
                        </div>
                      ))}
                      {Object.keys(monthlyStats.byPerson).length === 0 && (
                        <p className="text-gray-400 text-sm">No chores completed this month yet</p>
                      )}
                    </div>
                  </div>
                </div>

                <div className="bg-white rounded-2xl shadow-sm p-6">
                  <div className="text-lg font-medium text-gray-800 mb-4">Recent activity</div>
                  <div className="space-y-3 max-h-96 overflow-y-auto">
                    {completionHistory.slice(0, 20).map(completion => (
                      <div key={completion.id} className="flex justify-between items-center py-2">
                        <div>
                          <div className="font-medium text-gray-800">{completion.choreName}</div>
                          <div className="text-sm text-gray-500">{completion.completedBy}</div>
                        </div>
                        <span className="text-sm text-gray-400">{formatDate(completion.completedDate)}</span>
                      </div>
                    ))}
                    {completionHistory.length === 0 && (
                      <p className="text-gray-400 text-center py-8">No completions recorded yet</p>
                    )}
                  </div>
                </div>
              </div>
            )}

            {currentView === 'upcoming' && (
              <div className="space-y-3">
                {upcomingChores.map((chore) => (
                  <div
                    key={chore.id}
                    className={`bg-white rounded-xl shadow-sm border-2 border-transparent hover:border-teal-400 transition-all ${
                      animatingChoreId === chore.id ? 'animate-pulse' : ''
                    }`}
                    style={{
                      transition: 'all 0.5s ease-in-out',
                      transform: animatingChoreId === chore.id ? 'scale(1.02)' : 'scale(1)'
                    }}
                  >
                    <div
                      onClick={() => toggleChoreExpand(chore.id)}
                      className="p-4 cursor-pointer"
                    >
                      <div className="flex justify-between items-center">
                        <div className="flex-1">
                          <h3 className="font-semibold text-gray-800">{chore.name}</h3>
                          <p className="text-sm text-gray-500 mt-1">{chore.assignedTo}</p>
                        </div>
                        <div className="text-right">
                          <span className={`text-sm font-medium ${getStatusColor(chore.daysUntil)}`}>
                            {getStatusText(chore.daysUntil)}
                          </span>
                          <p className="text-xs text-gray-400 mt-1">{formatDate(chore.nextDue)}</p>
                        </div>
                      </div>
                    </div>

                    {expandedChoreId === chore.id && (
                      <div className="px-4 pb-4 pt-2 border-t border-gray-100">
                        <div className="mb-3">
                          <div className="text-sm mb-3 pt-3 border-t border-gray-100">
                            <span className={`font-medium ${getStatusColor(chore.daysUntil)}`}>
                              {getStatusText(chore.daysUntil)}
                            </span>
                            <span className="text-gray-400 ml-2">• Every {chore.frequency} days</span>
                          </div>

                          <div className="grid grid-cols-2 gap-3">
                            <button
                              onClick={() => markAsComplete(chore.id, 'Kawika')}
                              className="bg-teal-500 text-white py-2 px-4 rounded-xl font-medium hover:bg-teal-600 transition text-sm"
                            >
                              Kawika completed
                            </button>
                            <button
                              onClick={() => markAsComplete(chore.id, 'Jordyn')}
                              className="bg-white border-2 border-teal-500 text-teal-600 py-2 px-4 rounded-xl font-medium hover:bg-teal-50 transition text-sm"
                            >
                              Jordyn completed
                            </button>
                          </div>
                        </div>
                      </div>
                    )}
                  </div>
                ))}
              </div>
            )}

            {currentView === 'calendar' && (
              <div className="space-y-4">
                <div className="bg-white rounded-2xl shadow-sm p-6">
                  <div className="flex items-center justify-between mb-6">
                    <button
                      onClick={() => changeMonth(-1)}
                      className="w-10 h-10 rounded-full bg-gray-100 hover:bg-gray-200 flex items-center justify-center transition"
                    >
                      <span className="text-gray-600 text-xl">‹</span>
                    </button>
                    <div className="text-2xl font-medium text-gray-800">
                      {currentMonth.toLocaleDateString('en-US', { month: 'long', year: 'numeric' })}
                    </div>
                    <button
                      onClick={() => changeMonth(1)}
                      className="w-10 h-10 rounded-full bg-gray-100 hover:bg-gray-200 flex items-center justify-center transition"
                    >
                      <span className="text-gray-600 text-xl">›</span>
                    </button>
                  </div>

                  <div className="grid grid-cols-7 gap-2 mb-4">
                    {['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].map(day => (
                      <div key={day} className="text-center text-xs font-medium text-gray-500 py-1">
                        {day}
                      </div>
                    ))}
                  </div>

                  <div className="grid grid-cols-7 gap-2">
                    {(() => {
                      const { daysInMonth, startingDayOfWeek, year, month } = getDaysInMonth(currentMonth);
                      const days = [];

                      for (let i = 0; i < startingDayOfWeek; i++) {
                        days.push(<div key={`empty-${i}`} className="h-16" />);
                      }

                      for (let day = 1; day <= daysInMonth; day++) {
                        const date = new Date(year, month, day);
                        const { completed, upcoming } = getChoresForDate(date);
                        const isTodayDate = isToday(date);
                        const isSelected = isSameDay(date, selectedDate);

                        days.push(
                          <button
                            key={day}
                            onClick={() => setSelectedDate(date)}
                            className={`h-20 md:h-16 p-2 rounded-xl border-2 transition-all relative ${
                              isSelected
                                ? 'border-teal-500 bg-teal-50'
                                : isTodayDate
                                ? 'border-teal-300 bg-teal-50'
                                : completed.length > 0 || upcoming.length > 0
                                ? 'border-gray-200 bg-gray-50 hover:border-gray-300'
                                : 'border-gray-100 hover:border-gray-200'
                            }`}
                          >
                            <div className={`text-sm font-medium absolute top-2 left-2 ${
                              isTodayDate ? 'text-teal-600' : 'text-gray-700'
                            }`}>
                              {day}
                            </div>
                            <div className="absolute bottom-2 left-0 right-0 flex flex-col gap-1 items-center md:top-2 md:bottom-auto md:left-auto md:right-2 md:items-end">
                              {completed.length > 0 && (
                                <div className="flex items-center gap-1">
                                  <div className="w-6 h-1 bg-green-400 rounded-full"></div>
                                  <span className="text-xs text-green-700 font-medium leading-none">{completed.length}</span>
                                </div>
                              )}
                              {upcoming.length > 0 && (
                                <div className="flex items-center gap-1">
                                  <div className="w-6 h-1 bg-orange-400 rounded-full"></div>
                                  <span className="text-xs text-orange-700 font-medium leading-none">{upcoming.length}</span>
                                </div>
                              )}
                            </div>
                          </button>
                        );
                      }

                      return days;
                    })()}
                  </div>

                  <div className="mt-4 flex gap-4 text-xs">
                    <div className="flex items-center gap-2">
                      <div className="w-4 h-4 rounded border-2 border-teal-300 bg-teal-50" />
                      <span className="text-gray-600">Today</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <div className="w-4 h-1 rounded bg-green-400" />
                      <span className="text-gray-600">Completed</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <div className="w-4 h-1 rounded bg-orange-400" />
                      <span className="text-gray-600">Due</span>
                    </div>
                  </div>
                </div>

                <div className="bg-white rounded-2xl shadow-sm p-6">
                  <div className="flex items-center justify-between mb-6">
                    <h2 className="text-2xl font-bold text-gray-800">
                      {isToday(selectedDate) ? 'Today' : selectedDate.toLocaleDateString('en-US', { 
                        weekday: 'long', 
                        month: 'long', 
                        day: 'numeric',
                        year: 'numeric'
                      })}
                    </h2>
                    {!isToday(selectedDate) && (
                      <button
                        onClick={() => setSelectedDate(getHawaiiDate())}
                        className="px-4 py-2 bg-teal-100 text-teal-700 rounded-xl text-sm font-medium hover:bg-teal-200 transition"
                      >
                        Go to Today
                      </button>
                    )}
                  </div>

                  {(() => {
                    const { completed, upcoming } = getChoresForDate(selectedDate);
                    if (completed.length === 0 && upcoming.length === 0) {
                      return (
                        <div className="text-center py-12">
                          <Calendar className="w-16 h-16 text-gray-300 mx-auto mb-4" />
                          <p className="text-gray-400 text-lg">No chores for this day</p>
                        </div>
                      );
                    }

                    return (
                      <div className="space-y-6">
                        {completed.length > 0 && (
                          <div>
                            <h3 className="text-lg font-semibold text-gray-800 mb-3 flex items-center gap-2">
                              <CheckCircle className="w-5 h-5 text-green-600" />
                              Completed ({completed.length})
                            </h3>
                            <div className="space-y-2">
                              {completed.map((chore) => {
                                const choreKey = `completed-${chore.completionId}`;
                                const isExpanded = expandedCalendarChoreId === choreKey;
                                return (
                                  <div
                                    key={choreKey}
                                    className="bg-green-50 border-2 border-green-200 rounded-xl overflow-hidden"
                                  >
                                    <div
                                      onClick={() => setExpandedCalendarChoreId(isExpanded ? null : choreKey)}
                                      className="p-4 cursor-pointer hover:bg-green-100 transition"
                                    >
                                      <div className="flex justify-between items-start">
                                        <div className="flex-1">
                                          <h4 className="font-semibold text-gray-800">{chore.name}</h4>
                                          <p className="text-sm text-gray-600 mt-1">
                                            Completed by {chore.completedBy}
                                          </p>
                                        </div>
                                        <div className="text-xs text-green-700 bg-green-100 px-2 py-1 rounded-full">
                                          ✓ Done
                                        </div>
                                      </div>
                                    </div>

                                    {isExpanded && (
                                      <div className="px-4 pb-4 pt-2 border-t border-green-200 space-y-3">
                                        <div>
                                          <label className="text-xs text-gray-600 block mb-1">Completed on</label>
                                          <input
                                            type="date"
                                            value={editingCompletedDate || formatDateToInput(new Date(chore.completedDate))}
                                            onChange={(e) => setEditingCompletedDate(e.target.value)}
                                            className="w-full px-3 py-2 text-sm border-2 border-gray-200 rounded-lg focus:outline-none focus:border-teal-400"
                                          />
                                        </div>
                                        <div>
                                          <label className="text-xs text-gray-600 block mb-1">Completed by</label>
                                          <select
                                            value={editingCompletedBy || chore.completedBy}
                                            onChange={(e) => setEditingCompletedBy(e.target.value)}
                                            className="w-full px-3 py-2 text-sm border-2 border-gray-200 rounded-lg focus:outline-none focus:border-teal-400"
                                          >
                                            <option value="Kawika">Kawika</option>
                                            <option value="Jordyn">Jordyn</option>
                                          </select>
                                        </div>
                                        <button
                                          onClick={async () => {
                                            const newDate = createHawaiiDate(editingCompletedDate || formatDateToInput(new Date(chore.completedDate)));
                                            const newPerson = editingCompletedBy || chore.completedBy;
                                            await db.collection('completionHistory').doc(chore.completionId).update({
                                              completedDate: firebase.firestore.Timestamp.fromDate(newDate),
                                              completedBy: newPerson
                                            });

                                            await db.collection('changeLog').add({
                                              action: 'edited',
                                              choreName: chore.name,
                                              person: 'System',
                                              timestamp: firebase.firestore.Timestamp.fromDate(getHawaiiDate()),
                                              details: `Updated completion record for "${chore.name}"`
                                            });

                                            setEditingCompletedDate('');
                                            setEditingCompletedBy('');
                                            setExpandedCalendarChoreId(null);
                                          }}
                                          className="w-full bg-teal-500 text-white py-2 rounded-xl font-medium hover:bg-teal-600 transition text-sm"
                                        >
                                          Update Completion
                                        </button>
                                      </div>
                                    )}
                                  </div>
                                );
                              })}
                            </div>
                          </div>
                        )}

                        {upcoming.length > 0 && (
                          <div>
                            <h3 className="text-lg font-semibold text-gray-800 mb-3 flex items-center gap-2">
                              <Calendar className="w-5 h-5 text-orange-600" />
                              Due Today ({upcoming.length})
                            </h3>
                            <div className="space-y-2">
                              {upcoming.map((chore) => {
                                const choreKey = `upcoming-${chore.id}`;
                                const isExpanded = expandedCalendarChoreId === choreKey;
                                return (
                                  <div
                                    key={choreKey}
                                    className="bg-orange-50 border-2 border-orange-200 rounded-xl overflow-hidden"
                                  >
                                    <div
                                      onClick={() => setExpandedCalendarChoreId(isExpanded ? null : choreKey)}
                                      className="p-4 cursor-pointer hover:bg-orange-100 transition"
                                    >
                                      <div className="flex justify-between items-start">
                                        <div className="flex-1">
                                          <h4 className="font-semibold text-gray-800">{chore.name}</h4>
                                          <p className="text-sm text-gray-600 mt-1">
                                            Assigned to {chore.assignedTo} • Every {chore.frequency} days
                                          </p>
                                          <p className={`text-sm font-medium mt-1 ${getStatusColor(chore.daysUntil)}`}>
                                            {getStatusText(chore.daysUntil)}
                                          </p>
                                        </div>
                                      </div>
                                    </div>

                                    {isExpanded && (
                                      <div className="px-4 pb-4 pt-2 border-t border-orange-200 space-y-3">
                                        <div>
                                          <label className="text-xs text-gray-600 block mb-1">Reschedule due date</label>
                                          <input
                                            type="date"
                                            value={editingUpcomingDate || formatDateToInput(chore.nextDue)}
                                            onChange={(e) => setEditingUpcomingDate(e.target.value)}
                                            className="w-full px-3 py-2 text-sm border-2 border-gray-200 rounded-lg focus:outline-none focus:border-orange-400"
                                          />
                                        </div>
                                        <button
                                          onClick={async () => {
                                            const newDueDate = createHawaiiDate(editingUpcomingDate || formatDateToInput(chore.nextDue));
                                            const newLastCompleted = new Date(newDueDate);
                                            newLastCompleted.setDate(newDueDate.getDate() - chore.frequency);
                                            await db.collection('chores').doc(chore.id).update({
                                              lastCompleted: firebase.firestore.Timestamp.fromDate(newLastCompleted)
                                            });

                                            await db.collection('changeLog').add({
                                              action: 'edited',
                                              choreName: chore.name,
                                              person: 'System',
                                              timestamp: firebase.firestore.Timestamp.fromDate(getHawaiiDate()),
                                              details: `Rescheduled "${chore.name}" to be due on ${formatDate(newDueDate)}`
                                            });

                                            setEditingUpcomingDate('');
                                            setExpandedCalendarChoreId(null);
                                          }}
                                          className="w-full bg-orange-500 text-white py-2 rounded-xl font-medium hover:bg-orange-600 transition text-sm"
                                        >
                                          Update Due Date
                                        </button>

                                        {isToday(selectedDate) && (
                                          <>
                                            <div className="text-xs text-gray-500 text-center">or mark as complete</div>
                                            <div className="grid grid-cols-2 gap-2">
                                              <button
                                                onClick={() => markAsComplete(chore.id, 'Kawika')}
                                                className="bg-teal-500 text-white py-2 px-4 rounded-xl font-medium hover:bg-teal-600 transition text-sm"
                                              >
                                                Kawika completed
                                              </button>
                                              <button
                                                onClick={() => markAsComplete(chore.id, 'Jordyn')}
                                                className="bg-white border-2 border-teal-500 text-teal-600 py-2 px-4 rounded-xl font-medium hover:bg-teal-50 transition text-sm"
                                              >
                                                Jordyn completed
                                              </button>
                                            </div>
                                          </>
                                        )}
                                      </div>
                                    )}
                                  </div>
                                );
                              })}
                            </div>
                          </div>
                        )}
                      </div>
                    );
                  })()}
                </div>
              </div>
            )}
          </div>
        </div>
      );
    };

    ReactDOM.render(<ChoreTracker />, document.getElementById('root'));
  </script>
</body>
</html>